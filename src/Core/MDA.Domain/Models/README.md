1. 接收领域命令。

2. 根据领域命令携带的聚合跟信息，恢复状态。
   2.1 从缓存中恢复
       
   2.2 从状态后端恢复

3. 执行领域命令。

4. 发布领域事件。

5. 如何高效地持久化领域事件，平衡高吞吐和低延迟？
1. 每应用一次就持久化一次
   延迟最低，但碎片化IO严重影响吞吐量。

2. 按批异步持久化
   每次应用将事件加入到缓冲区，达到阈值或超时在持久化，并且将阈值和超时作为参数可配置，让用户可以根据应用场景来平衡。
2.1 

2.1 如何保证聚合根和事件版本一致性问题？
    聚合根一次状态变更的唯一性 = 聚合根版本号 + 事件版本号

    每个聚合根都以单线程的方式，按发生顺序处理入站命令，以保证状态变更的一致性。

Checkpoint时机
1. 定时
   系统周期性地进行。
2. 
   