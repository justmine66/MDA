# why - 为什么需要Saga?

践行领域驱动设计(DDD)时，战略上会采用域、子域、界限上下文来划分领域，战术上会进一步采用聚合根划分具体上下文，来封装业务的不变性，即业务规则，那么业务规则的分布就存在2种情况。如下：

- **一、同一上下文，不同聚合跟。**
- **二、不同上下文，不同聚合根。**

当一个业务规则需要多个上下文或多个聚合根协作才能完成时，那么问题来了，如果保证这种这种长业务数据的一致性？

### 情况一：同一个上下文的不同聚合根

1. 对于经典DDD架构模式，一般使用**领域服务(DomainService)**结合**资源库(Repository)**通过本地事务来保证业务的一致性。
2. 对于EDA(事件驱动)架构模式，这种架构模式一般使用**事件溯源(EventSourcing)**的方式来维护聚合跟的状态，一般同一聚合根内保证强一致性，不同聚合根之间只能做到最终一致性，对于这种情况就需要Saga解决方案。

> 备注：1987年普林斯顿大学的Hector Garcia-Molina和Kenneth Salem发表了一篇Paper Sagas，讲述了如何处理long lived transaction（长活事务），Saga因此得名，论文地址：https://www.cs.cornell.edu/andru/cs711/2002fa/reading/sagas.pdf。

### 情况二：不同上下文的不同聚合根

无论是何种架构模式，最终都是分布式事务，不同聚合根之间只能做到最终一致性，Saga是必须的解决方案。

# What - Saga是什么？

Saga