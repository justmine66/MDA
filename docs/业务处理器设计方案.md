# 前言

区别于传统的DDD，响应式DDD基于ActorModel，接收领域命令，处理领域逻辑，发出领域事件，整个过程完全是基于内存的，涉及到以下几个步骤：

1. 接收应用层发出的领域命令消息。
2. 执行领域命令，即处理业务规则。
3. 发送领域事件，存储状态和发出业务变更日志。

## 1. 应用层如何发送领域命令？

根据业务的不同，应用层可能会发送多个领域命令。

### 如何保证发送领域命令的高吞吐？

在消息传输的底层，命令并不是一个个的被发送的，而是采用批量发送的方式，应用层发送的领域命令并会首先放入一个缓冲区，当缓冲区达到阈值时，才会发送命令，阈值可静态配置，系统也会基于流量动态调整阈值(流控)，以便充分利用带宽。

### 如何保证发送领域命令的低延迟？

在同样的网络环境下，每收到一个消息就立即发送，这就是最低的延迟，但是这样高吞吐又无法实现，天生阻抗，既然无法同时满足，就只有权衡高吞吐和低延迟了，给消息设置超时发送时长，同时可以配置。

## 2. 领域层如何处理领域命令？

### 如何保证业务状态的精确一致性？

- 采用单线程处理领域命令，保证命令处理的顺序性。
- 采用预写命令技术，保证业务至少被成功处理一次。

## 3. 领域层如何告知命令处理结果？

- 当业务处理影响聚合根状态时，使用领域事件告知命令处理结果。
- 当业务处理未影响聚合根状态时，对于非Saga流程，使用领域异常告知命令已经被处理了；对于Saga流程，使用领域通知告知命令处理结果。